<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المتجر الإلكتروني المتكامل</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #e74c3c;
            --accent-color: #3498db;
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Tajawal', sans-serif;
            min-height: 100vh;
        }

        .product-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #eee;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            background: white;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.08);
        }

        .badge-offer {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 2;
            background: var(--secondary-color);
        }

        .quantity-controls {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 2px 10px;
        }

        .cart-item {
            animation: slideIn 0.3s ease forwards;
            background: #fff;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .search-container {
            position: relative;
            max-width: 500px;
            margin: 0 auto;
        }

        .search-results {
            position: absolute;
            width: 100%;
            z-index: 1000;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }

        .wishlist-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 2;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .rating-stars {
            color: #ffd700;
            font-size: 0.9em;
        }

        .product-details-modal img {
            max-height: 400px;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <!-- الهيدر المتطور -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-store me-2"></i>متجر التقنية
            </a>
            
            <div class="d-flex align-items-center gap-4">
                <div class="search-container">
                    <input type="text" id="searchInput" class="form-control" placeholder="ابحث عن منتج...">
                    <div id="searchResults" class="search-results"></div>
                </div>
                
                <div class="position-relative">
                    <i class="fas fa-heart text-white fs-5" 
                       data-bs-toggle="offcanvas" 
                       data-bs-target="#wishlistOffcanvas"></i>
                    <span id="wishlistBadge" 
                          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        0
                    </span>
                </div>

                <div class="position-relative">
                    <i class="fas fa-shopping-cart text-white fs-5" 
                       data-bs-toggle="offcanvas" 
                       data-bs-target="#cartOffcanvas"></i>
                    <span id="cartBadge" 
                          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        0
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <!-- المحتوى الرئيسي -->
    <main class="container my-5">
        <!-- فلترة المنتجات -->
        <div class="row mb-4">
            <div class="col-12">
                <div id="filters" class="d-flex flex-wrap gap-3">
                    <button class="btn btn-outline-primary active" data-filter="all">الكل</button>
                    <button class="btn btn-outline-primary" data-filter="price_asc">السعر من الأقل للأعلى</button>
                    <button class="btn btn-outline-primary" data-filter="price_desc">السعر من الأعلى للأقل</button>
                </div>
            </div>
        </div>

        <!-- عرض المنتجات -->
        <div class="row g-4" id="productsContainer"></div>
    </main>

    <!-- السلة الجانبية -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">سلة المشتريات</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <div id="cartItems"></div>
            <div class="cart-summary border-top pt-3 mt-3">
                <div class="d-flex justify-content-between mb-2">
                    <span>المجموع:</span>
                    <span id="subtotal">0.00 ر.س</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span>الخصم:</span>
                    <span id="discount">0.00 ر.س</span>
                </div>
                <div class="d-flex justify-content-between fw-bold">
                    <span>الإجمالي:</span>
                    <span id="total">0.00 ر.س</span>
                </div>
                <button class="btn btn-danger w-100 mt-4" onclick="clearCart()">
                    <i class="fas fa-trash me-2"></i>إفراغ السلة
                </button>
                <button class="btn btn-success w-100 mt-2" onclick="checkout()">
                    <i class="fas fa-credit-card me-2"></i>إتمام الشراء
                </button>
            </div>
        </div>
    </div>

    <!-- المفضلة الجانبية -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="wishlistOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">قائمة المفضلة</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <div id="wishlistItems"></div>
        </div>
    </div>

    <!-- تفاصيل المنتج -->
    <div class="modal fade" id="productModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body product-details-modal"></div>
            </div>
        </div>
    </div>

<script>
const store = {
    cart: JSON.parse(localStorage.getItem('store_cart')) || [],
    wishlist: JSON.parse(localStorage.getItem('store_wishlist')) || [],
    products: [],
    discounts: {
        'RAMADAN2024': 15,
        'WELCOME10': 10
    }
};

// نظام تحميل المنتجات
async function loadProducts() {
    try {
        const response = await fetch('products.txt');
        const data = await response.text();
        store.products = data.split('\n').filter(line => line.trim()).map((line, index) => {
            const [category, name, price, image, rating] = line.split('/').map(x => x.trim());
            return {
                id: index + 1,
                category,
                name,
                price: parseFloat(price.replace(/[^0-9.]/g, '')),
                image: image.startsWith('http') ? image : `images/${image}`,
                rating: parseFloat(rating) || 0,
                reviews: [],
                stock: Math.floor(Math.random() * 50) + 10,
                sku: `PROD-${Date.now().toString(36).toUpperCase()}`
            };
        });
        initStore();
    } catch (error) {
        console.error('Error loading products:', error);
        showError('تعذر تحميل المنتجات. يرجى المحاولة لاحقاً');
    }
}

// نظام التخزين
function saveToStorage() {
    localStorage.setItem('store_cart', JSON.stringify(store.cart));
    localStorage.setItem('store_wishlist', JSON.stringify(store.wishlist));
}

// نظام التقييمات
function addReview(productId, review) {
    const product = store.products.find(p => p.id === productId);
    if(product) {
        product.reviews.push({
            ...review,
            date: new Date().toISOString(),
            verified: false
        });
        renderProducts();
    }
}

// نظام البحث المتقدم
function searchProducts(query) {
    return store.products.filter(p => 
        p.name.toLowerCase().includes(query.toLowerCase()) ||
        p.category.toLowerCase().includes(query.toLowerCase())
    );
}

// نظام التصفية والترتيب
function filterProducts(filterType) {
    let filtered = [...store.products];
    
    switch(filterType) {
        case 'price_asc':
            filtered.sort((a, b) => a.price - b.price);
            break;
        case 'price_desc':
            filtered.sort((a, b) => b.price - a.price);
            break;
    }
    
    renderProducts(filtered);
}

// نظام عرض المنتجات
function renderProducts(products = store.products) {
    const container = document.getElementById('productsContainer');
    container.innerHTML = products.map(product => {
        const inCart = store.cart.find(item => item.id === product.id);
        const inWishlist = store.wishlist.includes(product.id);
        
        return `
        <div class="col-md-4 col-lg-3">
            <div class="product-card card h-100">
                ${product.stock < 5 ? 
                    `<span class="badge badge-offer">كمية محدودة</span>` : ''}
                
                <button class="btn btn-sm wishlist-btn ${inWishlist ? 'text-danger' : 'text-secondary'}" 
                        onclick="toggleWishlist(${product.id})">
                    <i class="fas fa-heart"></i>
                </button>

                <img src="${product.image}" 
                     class="card-img-top" 
                     alt="${product.name}"
                     loading="lazy"
                     style="height: 200px; object-fit: contain;"
                     onerror="this.src='https://via.placeholder.com/300?text=صورة+غير+متوفرة'"
                     data-bs-toggle="modal" 
                     data-bs-target="#productModal"
                     onclick="showProductDetails(${product.id})">

                <div class="card-body">
                    <h6 class="card-title">${product.name}</h6>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted small">${product.category}</span>
                        <div class="rating-stars">
                            ${Array(5).fill().map((_, i) => `
                                <i class="fas fa-star${i < Math.floor(product.rating) ? '' : '-half-alt'}"></i>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="h5 text-primary">${product.price.toFixed(2)} ر.س</span>
                        ${inCart ? `
                            <div class="quantity-controls">
                                <button class="btn btn-sm btn-outline-secondary" 
                                        onclick="updateCart(${product.id}, -1)">
                                    -
                                </button>
                                <span>${inCart.quantity}</span>
                                <button class="btn btn-sm btn-outline-secondary" 
                                        onclick="updateCart(${product.id}, 1)">
                                    +
                                </button>
                            </div>
                        ` : `
                            <button class="btn btn-primary btn-sm" 
                                    onclick="updateCart(${product.id}, 1)"
                                    ${product.stock < 1 ? 'disabled' : ''}>
                                <i class="fas fa-cart-plus"></i>
                                ${product.stock < 1 ? 'نفذت الكمية' : 'إضافة'}
                            </button>
                        `}
                    </div>
                </div>
            </div>
        </div>
        `;
    }).join('');
}

// نظام إدارة السلة
function updateCart(productId, quantityChange) {
    const product = store.products.find(p => p.id === productId);
    if(!product) return;

    const cartItem = store.cart.find(item => item.id === productId);
    
    if(cartItem) {
        cartItem.quantity += quantityChange;
        if(cartItem.quantity < 1) {
            store.cart = store.cart.filter(item => item.id !== productId);
        }
    } else {
        store.cart.push({...product, quantity: 1});
    }

    product.stock -= quantityChange;
    updateUI();
}

// نظام المفضلة
function toggleWishlist(productId) {
    const index = store.wishlist.indexOf(productId);
    if(index === -1) {
        store.wishlist.push(productId);
    } else {
        store.wishlist.splice(index, 1);
    }
    updateUI();
}

// نظام تحديث الواجهة
function updateUI() {
    saveToStorage();
    renderProducts();
    renderCart();
    renderWishlist();
    updateBadges();
}

// نظام الإخطارات
function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast position-fixed bottom-0 end-0 m-3 bg-${type} text-white`;
    toast.innerHTML = `
        <div class="d-flex align-items-center p-3">
            <i class="fas fa-${type === 'success' ? 'check' : 'exclamation'}-circle me-2"></i>
            <span>${message}</span>
        </div>
    `;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

// نظام الدفع
function checkout() {
    if(store.cart.length === 0) return showToast('السلة فارغة', 'danger');
    
    const total = calculateTotal();
    const invoice = {
        date: new Date(),
        items: store.cart,
        total,
        status: 'pending'
    };
    
    // إرسال الفاتورة إلى الخادم هنا
    showToast('تم إتمام الشراء بنجاح', 'success');
    store.cart = [];
    updateUI();
}

// نظام الحسابات
function calculateTotal() {
    const subtotal = store.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const discount = 0; // يمكن إضافة نظام الخصومات هنا
    return subtotal - discount;
}

// التهيئة الأولية
function initStore() {
    document.querySelectorAll('[data-filter]').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('[data-filter]').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            filterProducts(btn.dataset.filter);
        });
    });

    document.getElementById('searchInput').addEventListener('input', (e) => {
        const results = searchProducts(e.target.value);
        renderSearchResults(results);
    });

    updateUI();
}

// بدء التحميل
loadProducts();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
